package com.project.demo.service;

import org.springframework.mail.SimpleMailMessage;
import org.springframework.mail.javamail.JavaMailSender;
import org.springframework.stereotype.Service;

import lombok.RequiredArgsConstructor;

import static com.project.demo.data.PathConstantData.API_VUE;
import static com.project.demo.data.PathConstantData.API_ACT_LINK;

@Service
@RequiredArgsConstructor
public class MailService {

	private final JavaMailSender mailSender;

	public void sendActivationEmail(String email, String activationCode) {

		String subject = "【帳號啟用通知】請點擊連結完成註冊";

		String link = API_VUE + API_ACT_LINK;
		
		// 你的前端或 API 啟用連結，這裡可換成實際網址
		String activationLink = String.format(link, urlEncode(email), urlEncode(activationCode));

		String body = "您好，\n\n請點擊以下連結以啟用您的帳號：\n" + activationLink + "\n\n感謝您的註冊！";

		SimpleMailMessage message = new SimpleMailMessage();
		message.setTo(email);
		message.setSubject(subject);
		message.setText(body);

		mailSender.send(message);
	}

	private String urlEncode(String s) {
		return java.net.URLEncoder.encode(s, java.nio.charset.StandardCharsets.UTF_8);
	}
}
